import{E as te,r as n,F as ae,G as Ee,w as k,l,f as Fe,g as _e,o as Ae,j as e,e as $,c as Me,n as ze,H as je,p as Pe,S as Ne,J as X,K as Q,M as Le,N as De,B as I,s as Be,u as fe,I as Te}from"./index-DaKMN1yZ.js";import{V as z,c as Ue,j as He,o as ge,g as We,p as Ke}from"./index-DCkPA7ii.js";import{b as Ve,F as re,I as qe}from"./chunk-6CVSDS6C-BbEwV9Gm.js";import{d as be,B as N,T as w}from"./chunk-ZHMYA64R-DpJu8I27.js";import{t as Oe}from"./index-DdrsuNi1.js";import{C as $e,T as Ge,a as Je,b as G,c as Xe,d as J}from"./chunk-IAXSQ4X2-DacyWhRH.js";import{H as P}from"./chunk-7OLJDQMT-BqdKiONh.js";import{F as ne}from"./chunk-H46NUPBZ-DTsN5Duz.js";import{F as Qe}from"./chunk-VGESXGVT-DsD-yEVV.js";import{D as Y,H as pe}from"./chunk-W7WUSNWJ-xyNjI2Wo.js";import{C as Ye}from"./chunk-5MKCW436-Crl8gLHr.js";import{B as ie}from"./chunk-Z6RXEUPO-VoMs9AXz.js";import{F as Z}from"./index-DM64X-fq.js";import"./iconBase-_M4XJSaB.js";var Ze={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function es(a,h=[]){const r=Object.assign({},a);for(const i of h)i in r&&delete r[i];return r}function ss(a={}){const h=Ve(a),{isDisabled:r,isReadOnly:i,isRequired:f,isInvalid:o,id:d,onBlur:m,onFocus:u,"aria-describedby":g}=h,{defaultChecked:S,isChecked:p,isFocusable:R,onChange:j,isIndeterminate:s,name:y,value:_,tabIndex:A=void 0,"aria-label":L,"aria-labelledby":D,"aria-invalid":B,...ee}=a,T=es(ee,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),U=te(j),K=te(m),c=te(u),[E,ye]=n.useState(!1),[F,V]=n.useState(!1),[H,ce]=n.useState(!1),[W,M]=n.useState(!1);n.useEffect(()=>Oe(ye),[]);const v=n.useRef(null),[de,ke]=n.useState(!0),[Se,q]=n.useState(!!S),se=p!==void 0,x=se?p:Se,ue=n.useCallback(t=>{if(i||r){t.preventDefault();return}se||q(x?t.target.checked:s?!0:t.target.checked),U==null||U(t)},[i,r,x,se,s,U]);ae(()=>{v.current&&(v.current.indeterminate=!!s)},[s]),Ee(()=>{r&&V(!1)},[r,V]),ae(()=>{const t=v.current;if(!(t!=null&&t.form))return;const b=()=>{q(!!S)};return t.form.addEventListener("reset",b),()=>{var C;return(C=t.form)==null?void 0:C.removeEventListener("reset",b)}},[]);const he=r&&!R,me=n.useCallback(t=>{t.key===" "&&M(!0)},[M]),xe=n.useCallback(t=>{t.key===" "&&M(!1)},[M]);ae(()=>{if(!v.current)return;v.current.checked!==x&&q(v.current.checked)},[v.current]);const ve=n.useCallback((t={},b=null)=>{const C=O=>{F&&O.preventDefault(),M(!0)};return{...t,ref:b,"data-active":l(W),"data-hover":l(H),"data-checked":l(x),"data-focus":l(F),"data-focus-visible":l(F&&E),"data-indeterminate":l(s),"data-disabled":l(r),"data-invalid":l(o),"data-readonly":l(i),"aria-hidden":!0,onMouseDown:k(t.onMouseDown,C),onMouseUp:k(t.onMouseUp,()=>M(!1)),onMouseEnter:k(t.onMouseEnter,()=>ce(!0)),onMouseLeave:k(t.onMouseLeave,()=>ce(!1))}},[W,x,r,F,E,H,s,o,i]),Ce=n.useCallback((t={},b=null)=>({...t,ref:b,"data-active":l(W),"data-hover":l(H),"data-checked":l(x),"data-focus":l(F),"data-focus-visible":l(F&&E),"data-indeterminate":l(s),"data-disabled":l(r),"data-invalid":l(o),"data-readonly":l(i)}),[W,x,r,F,E,H,s,o,i]),we=n.useCallback((t={},b=null)=>({...T,...t,ref:be(b,C=>{C&&ke(C.tagName==="LABEL")}),onClick:k(t.onClick,()=>{var C;de||((C=v.current)==null||C.click(),requestAnimationFrame(()=>{var O;(O=v.current)==null||O.focus({preventScroll:!0})}))}),"data-disabled":l(r),"data-checked":l(x),"data-invalid":l(o)}),[T,r,x,o,de]),Ie=n.useCallback((t={},b=null)=>({...t,ref:be(v,b),type:"checkbox",name:y,value:_,id:d,tabIndex:A,onChange:k(t.onChange,ue),onBlur:k(t.onBlur,K,()=>V(!1)),onFocus:k(t.onFocus,c,()=>V(!0)),onKeyDown:k(t.onKeyDown,me),onKeyUp:k(t.onKeyUp,xe),required:f,checked:x,disabled:he,readOnly:i,"aria-label":L,"aria-labelledby":D,"aria-invalid":B?!!B:o,"aria-describedby":g,"aria-disabled":r,style:Ze}),[y,_,d,ue,K,c,me,xe,f,x,he,i,L,D,B,o,g,r,A]),Re=n.useCallback((t={},b=null)=>({...t,ref:b,onMouseDown:k(t.onMouseDown,ts),"data-disabled":l(r),"data-checked":l(x),"data-invalid":l(o)}),[x,r,o]);return{state:{isInvalid:o,isFocused:F,isChecked:x,isActive:W,isHovered:H,isIndeterminate:s,isDisabled:r,isReadOnly:i,isRequired:f},getRootProps:we,getCheckboxProps:ve,getIndicatorProps:Ce,getInputProps:Ie,getLabelProps:Re,htmlProps:T}}function ts(a){a.preventDefault(),a.stopPropagation()}var le=Fe(function(h,r){const i=_e("Switch",h),{spacing:f="0.5rem",children:o,...d}=Ae(h),{getIndicatorProps:m,getInputProps:u,getCheckboxProps:g,getRootProps:S,getLabelProps:p}=ss(d),R=n.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...i.container}),[i.container]),j=n.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...i.track}),[i.track]),s=n.useMemo(()=>({userSelect:"none",marginStart:f,...i.label}),[f,i.label]);return e.jsxs($.label,{...S(),className:Me("chakra-switch",h.className),__css:R,children:[e.jsx("input",{className:"chakra-switch__input",...u({},r)}),e.jsx($.span,{...g(),className:"chakra-switch__track",__css:j,children:e.jsx($.span,{__css:i.thumb,className:"chakra-switch__thumb",...m()})}),o&&e.jsx($.span,{className:"chakra-switch__label",...p(),__css:s,children:o})]})});le.displayName="Switch";const as=()=>{const{user:a,isAuthenticated:h}=ze(),{notificationSettings:r,updateNotificationSettings:i,fetchNotificationSettings:f}=je(),o=Pe(),[d,m]=n.useState(""),[u,g]=n.useState(!1),[S,p]=n.useState(!1),[R,j]=n.useState(!0),[s,y]=n.useState(""),[_,A]=n.useState(null),[L,D]=n.useState(0);n.useEffect(()=>{(async()=>{if(!h||!a){j(!1),A("คุณยังไม่ได้เข้าสู่ระบบ กรุณาเข้าสู่ระบบเพื่อเข้าถึงการตั้งค่า");return}j(!0);try{await f(),A(null)}catch(E){console.error("Error loading notification settings:",E),A("ไม่สามารถโหลดการตั้งค่าการแจ้งเตือนได้"),L>0&&o({title:"ไม่สามารถโหลดการตั้งค่าการแจ้งเตือนได้",status:"error",duration:3e3,isClosable:!0})}finally{j(!1),D(E=>E+1)}})()},[f,o,h,a,L]),n.useEffect(()=>{r?(g(r.enableEmailNotifications),m(r.email||(a==null?void 0:a.email)||"")):a&&m(a.email||"")},[r,a]);const B=c=>!c||c.trim()===""?"กรุณาระบุอีเมล":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c)?"":"รูปแบบอีเมลไม่ถูกต้อง",ee=async()=>{if(y(""),u){const c=B(d);if(c){y(c);return}}p(!0);try{await i({enableEmailNotifications:u,email:u?d.trim():void 0}),o({title:"บันทึกการตั้งค่าสำเร็จ",status:"success",duration:3e3,isClosable:!0})}catch(c){console.error("Error saving notification settings:",c),o({title:"ไม่สามารถบันทึกการตั้งค่าได้",description:"โปรดลองอีกครั้งในภายหลัง",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},T=c=>{m(c.target.value),s&&y("")},U=()=>{const c=!u;g(c),!c&&s&&y("")},K=()=>{A(null),D(0)};return R?e.jsx($e,{py:8,children:e.jsx(Ne,{size:"lg",color:"brand.500"})}):_?e.jsxs(X,{status:"error",variant:"subtle",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:"200px",borderRadius:"lg",children:[e.jsx(Q,{boxSize:"40px",mr:0}),e.jsx(Le,{mt:4,mb:1,fontSize:"lg",children:"เกิดข้อผิดพลาด"}),e.jsx(De,{maxWidth:"sm",children:_}),e.jsx(N,{mt:4,colorScheme:"red",onClick:K,children:"ลองใหม่อีกครั้ง"})]}):e.jsx(I,{borderWidth:"1px",borderRadius:"lg",p:6,shadow:"md",bg:"white",maxW:"600px",mx:"auto",children:e.jsxs(z,{spacing:6,align:"stretch",children:[e.jsx(P,{size:"md",children:"ตั้งค่าการแจ้งเตือน"}),e.jsxs(I,{children:[e.jsx(P,{size:"sm",mb:4,children:"ช่องทางการแจ้งเตือน"}),e.jsxs(z,{spacing:4,align:"stretch",children:[e.jsxs(re,{display:"flex",alignItems:"center",children:[e.jsx(le,{id:"in-app-notifications",isChecked:!0,isDisabled:!0,mr:3}),e.jsxs(I,{children:[e.jsx(ne,{htmlFor:"in-app-notifications",mb:0,children:"แจ้งเตือนในแอปพลิเคชัน"}),e.jsx(w,{fontSize:"xs",color:"gray.500",children:"การแจ้งเตือนในแอปพลิเคชันเปิดใช้งานเสมอสำหรับทุกบัญชี"})]})]}),e.jsxs(re,{display:"flex",alignItems:"center",children:[e.jsx(le,{id:"email-notifications",isChecked:u,onChange:U,mr:3}),e.jsxs(I,{children:[e.jsx(ne,{htmlFor:"email-notifications",mb:0,children:"แจ้งเตือนทางอีเมล"}),e.jsx(w,{fontSize:"xs",color:"gray.500",children:"รับการแจ้งเตือนสำคัญทางอีเมล"})]})]}),u&&e.jsxs(re,{pl:10,isInvalid:!!s,children:[e.jsx(ne,{fontSize:"sm",children:"อีเมลสำหรับรับการแจ้งเตือน"}),e.jsx(qe,{name:"emailAddress",value:d,onChange:T,placeholder:"your-email@example.com",size:"sm",type:"email",isRequired:!0}),s&&e.jsx(Qe,{children:s}),e.jsx(w,{fontSize:"xs",color:"gray.500",mt:1,children:"หมายเหตุ: ระบบจะส่งอีเมลเฉพาะเมื่อมีการแจ้งเตือนสำคัญเท่านั้น เช่น เมื่อพบสุนัขที่อาจตรงกับที่คุณหา หรือเมื่อมีการอัพเดทสถานะสุนัขของคุณ"})]})]})]}),e.jsx(Y,{}),e.jsxs(I,{children:[e.jsx(P,{size:"sm",mb:2,children:"ข้อมูลการแจ้งเตือน"}),e.jsx(w,{fontSize:"sm",color:"gray.600",mb:4,children:"ขณะนี้ คุณจะได้รับการแจ้งเตือนในกรณีต่อไปนี้:"}),e.jsxs(z,{spacing:2,align:"stretch",pl:4,children:[e.jsx(w,{fontSize:"sm",children:"• เมื่อพบสุนัขที่อาจตรงกับที่คุณกำลังหา"}),e.jsx(w,{fontSize:"sm",children:"• เมื่อมีการอัพเดทสถานะสุนัขของคุณ"}),e.jsx(w,{fontSize:"sm",children:"• เมื่อมีผู้ใช้งานอื่นตอบกลับประกาศของคุณ"})]})]}),e.jsx(N,{colorScheme:"brand",onClick:ee,isLoading:S,alignSelf:"flex-end",mt:4,children:"บันทึกการตั้งค่า"})]})})},oe=({notification:a,onMarkAsRead:h,onMarkAsUnread:r,onSelect:i})=>{const f=fe(a.read?"white":"gray.50",a.read?"gray.800":"gray.700");let o,d;switch(a.type){case"match":o=ge,d="orange.500";break;case"status_update":o=Ke,d="green.500";break;case"comment":o=We,d="blue.500";break;default:o=ge,d="gray.500"}return e.jsx(I,{p:4,bg:f,borderRadius:"md",borderLeft:a.read?"none":"4px solid",borderColor:"brand.500",_hover:{bg:fe("gray.100","gray.600")},cursor:"pointer",onClick:()=>i(a),children:e.jsxs(Z,{justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(pe,{spacing:4,flex:1,children:[e.jsx(Te,{as:o,boxSize:5,color:d}),e.jsxs(I,{flex:1,children:[e.jsx(w,{fontWeight:a.read?"medium":"bold",children:a.title}),e.jsx(w,{fontSize:"sm",color:"gray.600",mt:1,children:a.message}),e.jsx(w,{fontSize:"xs",color:"gray.500",mt:2,children:new Date(a.createdAt).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx(pe,{spacing:1,children:a.read?e.jsx(N,{size:"xs",variant:"ghost",leftIcon:e.jsx(Ue,{}),onClick:m=>{m.stopPropagation(),r(a._id)},children:"ทำเครื่องหมายว่ายังไม่ได้อ่าน"}):e.jsx(N,{size:"xs",variant:"ghost",leftIcon:e.jsx(He,{}),onClick:m=>{m.stopPropagation(),h(a._id)},children:"ทำเครื่องหมายว่าอ่านแล้ว"})})]})})},js=()=>{const{notifications:a,markAsRead:h,markAllAsRead:r}=je(),i=Be(),[f,o]=n.useState(0),[d,m]=n.useState([]),u=a.map(s=>d.includes(s._id)?{...s,read:!1}:s),g=u.filter(s=>!s.read),S=u.filter(s=>s.read),p=s=>{h(s),m(y=>y.filter(_=>_!==s))},R=s=>{m(y=>[...y,s])},j=s=>{h(s._id),s.type==="match"&&s.data.dogId?i(`/dogs/${s.data.dogId}`):s.type==="status_update"&&s.data.dogId&&i(`/dogs/${s.data.dogId}`)};return e.jsx(Ye,{maxW:"container.lg",py:8,children:e.jsxs(Ge,{isFitted:!0,colorScheme:"brand",index:f,onChange:o,children:[e.jsxs(Je,{mb:4,children:[e.jsxs(G,{children:["ทั้งหมด",e.jsx(ie,{ml:2,colorScheme:"brand",variant:"solid",borderRadius:"full",children:u.length})]}),e.jsxs(G,{children:["ยังไม่ได้อ่าน",e.jsx(ie,{ml:2,colorScheme:"red",variant:"solid",borderRadius:"full",children:g.length})]}),e.jsxs(G,{children:["อ่านแล้ว",e.jsx(ie,{ml:2,colorScheme:"gray",variant:"solid",borderRadius:"full",children:S.length})]}),e.jsx(G,{children:"ตั้งค่า"})]}),e.jsxs(Xe,{children:[e.jsx(J,{p:0,children:e.jsxs(I,{bg:"white",borderRadius:"lg",shadow:"sm",children:[e.jsxs(Z,{justify:"space-between",align:"center",p:4,borderBottomWidth:"1px",children:[e.jsx(P,{size:"md",children:"การแจ้งเตือนทั้งหมด"}),g.length>0&&e.jsx(N,{size:"sm",onClick:r,children:"ทำเครื่องหมายว่าอ่านทั้งหมด"})]}),u.length===0?e.jsxs(X,{status:"info",children:[e.jsx(Q,{}),"ไม่มีการแจ้งเตือน"]}):e.jsx(z,{spacing:1,align:"stretch",divider:e.jsx(Y,{}),children:u.map(s=>e.jsx(oe,{notification:s,onMarkAsRead:p,onMarkAsUnread:R,onSelect:j},s._id))})]})}),e.jsx(J,{p:0,children:e.jsxs(I,{bg:"white",borderRadius:"lg",shadow:"sm",children:[e.jsxs(Z,{justify:"space-between",align:"center",p:4,borderBottomWidth:"1px",children:[e.jsx(P,{size:"md",children:"การแจ้งเตือนที่ยังไม่ได้อ่าน"}),g.length>0&&e.jsx(N,{size:"sm",onClick:r,children:"ทำเครื่องหมายว่าอ่านทั้งหมด"})]}),g.length===0?e.jsxs(X,{status:"success",p:4,children:[e.jsx(Q,{}),"ไม่มีการแจ้งเตือนที่ยังไม่ได้อ่าน"]}):e.jsx(z,{spacing:1,align:"stretch",divider:e.jsx(Y,{}),children:g.map(s=>e.jsx(oe,{notification:s,onMarkAsRead:p,onMarkAsUnread:R,onSelect:j},s._id))})]})}),e.jsx(J,{p:0,children:e.jsxs(I,{bg:"white",borderRadius:"lg",shadow:"sm",children:[e.jsx(Z,{justify:"space-between",align:"center",p:4,borderBottomWidth:"1px",children:e.jsx(P,{size:"md",children:"การแจ้งเตือนที่อ่านแล้ว"})}),S.length===0?e.jsxs(X,{status:"info",p:4,children:[e.jsx(Q,{}),"ไม่มีการแจ้งเตือนที่อ่านแล้ว"]}):e.jsx(z,{spacing:1,align:"stretch",divider:e.jsx(Y,{}),children:S.map(s=>e.jsx(oe,{notification:s,onMarkAsRead:p,onMarkAsUnread:R,onSelect:j},s._id))})]})}),e.jsx(J,{p:0,children:e.jsx(as,{})})]})]})})};export{js as default};
