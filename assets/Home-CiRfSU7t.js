import{r as s,u as w,d as k,j as e,B as i,L as v}from"./index-DaKMN1yZ.js";import{F as z,a as D,V as E,b as A}from"./index-DCkPA7ii.js";import{M as F,T as B,a as R,l,u as _}from"./leaflet-C4RW84Ki.js";import{M as C,a as h,P as H,b as O}from"./PotentialMatches-PelzG0Np.js";import{I as T,a as V,S as U,D as N}from"./DogListView-DOMIF1io.js";import{I as W}from"./chunk-6CVSDS6C-BbEwV9Gm.js";import{M as G,a as P,b as q}from"./chunk-Z3VR2BFQ-gVd_s3GH.js";import{H as Q}from"./chunk-W7WUSNWJ-xyNjI2Wo.js";import{B as g,T as I}from"./chunk-ZHMYA64R-DpJu8I27.js";import{H as $}from"./chunk-7OLJDQMT-BqdKiONh.js";import{B as Y}from"./chunk-Z6RXEUPO-VoMs9AXz.js";import"./iconBase-_M4XJSaB.js";import"./chunk-4FCEGNGT-Dti3ODPF.js";import"./chunk-QINAG4RG-CdqfM4pg.js";import"./index-DM64X-fq.js";const J=new l.Icon({iconUrl:"/marker-lost-custom.svg",iconSize:[40,57],iconAnchor:[20,57],popupAnchor:[0,-50]}),K=new l.Icon({iconUrl:"/marker-found-custom.svg",iconSize:[40,57],iconAnchor:[20,57],popupAnchor:[0,-50]}),X=new l.Icon({iconUrl:"/marker-lost-custom.svg",iconSize:[50,71],iconAnchor:[25,71],popupAnchor:[0,-65]}),Z=new l.Icon({iconUrl:"/marker-found-custom.svg",iconSize:[50,71],iconAnchor:[25,71],popupAnchor:[0,-65]}),ee=[18.7883,98.9853],oe=({selectedDog:r})=>{const p=_();return s.useEffect(()=>{r&&p.setView(new l.LatLng(r.location.coordinates[1],r.location.coordinates[0]),15)},[r,p]),null},ge=()=>{const[r,p]=s.useState([]),[b,j]=s.useState([]),[u,m]=s.useState(""),[a,L]=s.useState(null),[n,y]=s.useState({type:[],status:["active"]}),d=s.useRef(null),M=w("white","gray.800"),x=w("gray.100","gray.700"),S=s.useCallback(async()=>{try{const o={};n.type.length===1&&(o.type=n.type[0]),n.status.length===1&&(o.status=n.status[0]);const t=await k.getDogs(o);p(t),j(t)}catch(o){console.error("Error fetching dogs:",o)}},[n]);s.useEffect(()=>{S()},[S]),s.useEffect(()=>{let o=r;if(u){const t=u.toLowerCase();o=o.filter(c=>c.breed.toLowerCase().includes(t)||c.color.toLowerCase().includes(t)||c.locationName.toLowerCase().includes(t)||c.name&&c.name.toLowerCase().includes(t))}j(o)},[u,r]);const f=o=>{if(L(o),d.current){const t=d.current.querySelector(`[data-dog-id="${o._id}"]`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})}};return e.jsxs(i,{children:[e.jsx(i,{bg:"white",py:2,borderBottom:"1px",borderColor:x,children:e.jsxs(Q,{spacing:4,justify:"center",px:4,children:[e.jsxs(T,{maxW:{base:"100%",md:"600px"},children:[e.jsx(V,{pointerEvents:"none",children:e.jsx(z,{color:"gray.300"})}),e.jsx(W,{placeholder:"ค้นหาสุนัข...",bg:M,border:"1px",borderColor:x,value:u,onChange:o=>m(o.target.value)})]}),e.jsxs(G,{closeOnSelect:!1,children:[e.jsx(P,{as:g,leftIcon:e.jsx(D,{}),variant:"outline",children:"ตัวกรอง"}),e.jsxs(q,{minWidth:"240px",children:[e.jsxs(C,{title:"ประเภท",type:"checkbox",value:n.type,onChange:o=>{y({...n,type:o}),m("")},children:[e.jsx(h,{value:"lost",children:"สุนัขหาย"}),e.jsx(h,{value:"found",children:"พบสุนัข"})]}),e.jsxs(C,{title:"สถานะ",type:"checkbox",value:n.status,onChange:o=>{y({...n,status:o}),m("")},children:[e.jsx(h,{value:"active",children:"กำลังค้นหา"}),e.jsx(h,{value:"resolved",children:"พบเจอแล้ว"})]})]})]})]})}),e.jsxs(U,{columns:{base:1,lg:2},spacing:0,minH:"600px",h:{base:"auto",lg:"calc(100vh - 200px)"},children:[e.jsx(i,{ref:d,gridColumn:{base:"1",lg:"1"},overflowY:"auto",borderRight:{base:"none",lg:"1px"},borderColor:x,bg:"white",h:"100%",children:e.jsxs(i,{p:4,children:[e.jsx($,{size:"md",mb:4,children:"รายการล่าสุด"}),e.jsx(N,{dogs:b,selectedDog:a,onDogSelect:f,columns:{base:1,md:2,lg:3}})]})}),e.jsxs(i,{position:"relative",h:{base:"400px",lg:"100%"},gridColumn:{base:"1",lg:"2"},children:[e.jsxs(F,{center:ee,zoom:13,style:{height:"100%",width:"100%"},children:[e.jsx(oe,{selectedDog:a}),e.jsx(B,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors © <a href="https://carto.com/attributions">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),b.map(o=>e.jsx(R,{position:[o.location.coordinates[1],o.location.coordinates[0]],icon:(a==null?void 0:a._id)===o._id?o.type==="lost"?X:Z:o.type==="lost"?J:K,eventHandlers:{click:()=>f(o)},children:e.jsx(H,{children:e.jsx(i,{className:"custom-popup",p:2,maxW:"200px",children:e.jsxs(E,{align:"stretch",spacing:2,children:[e.jsx(Y,{colorScheme:o.type==="lost"?"red":"green",fontSize:"xs",px:2,py:.5,borderRadius:"full",alignSelf:"flex-start",children:o.type==="lost"?"สุนัขหาย":"พบสุนัข"}),e.jsx(I,{fontWeight:"bold",fontSize:"sm",noOfLines:1,children:o.name||o.breed}),e.jsx(I,{fontSize:"xs",color:"gray.600",noOfLines:1,children:o.locationName}),e.jsx(g,{as:v,to:`/dogs/${o._id}`,size:"xs",colorScheme:"brand",width:"full",mt:1,children:"ดูรายละเอียด"})]})})})},o._id))]}),e.jsx(g,{as:v,to:"/map",position:"absolute",bottom:4,right:4,leftIcon:e.jsx(A,{}),colorScheme:"brand",size:"lg",zIndex:1e3,bg:"white",color:"gray.800",_hover:{bg:"gray.100"},boxShadow:"md",children:"เปิดแผนที่เต็ม"})]})]}),a&&e.jsx(O,{selectedDog:a,allDogs:r,onMatchSelect:f})]})};export{ge as default};
