import{a as z,r as h,b as D,i as E,u as B,j as e,B as x,L as _,d as F}from"./index-DaKMN1yZ.js";import{V as k,c as T,d as V,F as R,a as N}from"./index-DCkPA7ii.js";import{M as P,T as U,a as W,l as v,u as H}from"./leaflet-C4RW84Ki.js";import{P as Q,b as G,M as L,a as w}from"./PotentialMatches-PelzG0Np.js";import{M as Y,I as X,a as J,D as K}from"./DogListView-DOMIF1io.js";import{b as Z,a as $,T as C,B as I}from"./chunk-ZHMYA64R-DpJu8I27.js";import{I as q,D as ee,a as te}from"./chunk-65IR7CTH-CPIYFkYf.js";import{M as se,a as oe,b as ne}from"./chunk-4FCEGNGT-Dti3ODPF.js";import{u as re,M as ae,a as ie,b as ce}from"./chunk-Z3VR2BFQ-gVd_s3GH.js";import{H as le}from"./chunk-7OLJDQMT-BqdKiONh.js";import{B as ue}from"./chunk-Z6RXEUPO-VoMs9AXz.js";import{I as pe}from"./chunk-6CVSDS6C-BbEwV9Gm.js";import"./iconBase-_M4XJSaB.js";import"./chunk-W7WUSNWJ-xyNjI2Wo.js";import"./chunk-QINAG4RG-CdqfM4pg.js";import"./index-DM64X-fq.js";function de(s,i={}){const{ssr:p=!0,fallback:n}=i,{getWindow:r}=z(),u=Array.isArray(s)?s:[s];let c=Array.isArray(n)?n:[n];c=c.filter(o=>o!=null);const[b,l]=h.useState(()=>u.map((o,f)=>({media:o,matches:p?!!c[f]:r().matchMedia(o).matches})));return h.useEffect(()=>{const o=r();l(u.map(a=>({media:a,matches:o.matchMedia(a).matches})));const f=u.map(a=>o.matchMedia(a)),m=a=>{l(g=>g.slice().map(j=>j.media===a.media?{...j,matches:a.matches}:j))};return f.forEach(a=>{typeof a.addListener=="function"?a.addListener(m):a.addEventListener("change",m)}),()=>{f.forEach(a=>{typeof a.removeListener=="function"?a.removeListener(m):a.removeEventListener("change",m)})}},[r]),b.map(o=>o.matches)}function he(s,i,p=Z){let n=Object.keys(s).indexOf(i);if(n!==-1)return s[i];let r=p.indexOf(i);for(;r>=0;){const u=p[r];if(s.hasOwnProperty(u)){n=r;break}r-=1}if(n!==-1){const u=p[n];return s[u]}}function fe(s){var i,p;const n=E(s)?s:{fallback:s??"base"},u=D().__breakpoints.details.map(({minMaxQuery:o,breakpoint:f})=>({breakpoint:f,query:o.replace("@media screen and ","")})),c=u.map(o=>o.breakpoint===n.fallback),l=de(u.map(o=>o.query),{fallback:c,ssr:n.ssr}).findIndex(o=>o==!0);return(p=(i=u[l])==null?void 0:i.breakpoint)!=null?p:n.fallback}function A(s,i){var p;const n=E(i)?i:{fallback:"base"},r=fe(n),u=D();if(!r)return;const c=Array.from(((p=u.__breakpoints)==null?void 0:p.keys)||[]),b=Array.isArray(s)?Object.fromEntries(Object.entries($(s,c)).map(([l,o])=>[l,o])):s;return he(b,r,c)}const me=new v.Icon({iconUrl:"/marker-lost-custom.svg",iconSize:[40,57],iconAnchor:[20,57],popupAnchor:[0,-50]}),xe=new v.Icon({iconUrl:"/marker-found-custom.svg",iconSize:[40,57],iconAnchor:[20,57],popupAnchor:[0,-50]}),be=new v.Icon({iconUrl:"/marker-lost-custom.svg",iconSize:[50,71],iconAnchor:[25,71],popupAnchor:[0,-65]}),je=new v.Icon({iconUrl:"/marker-found-custom.svg",iconSize:[50,71],iconAnchor:[25,71],popupAnchor:[0,-65]}),ge=[18.7883,98.9853],ye=({selectedDog:s})=>{const i=H();return h.useEffect(()=>{s&&i.setView(new v.LatLng(s.location.coordinates[1],s.location.coordinates[0]),15)},[s,i]),null},Te=()=>{const[s,i]=h.useState([]),[p,n]=h.useState([]),[r,u]=h.useState(""),[c,b]=h.useState(null),[l,o]=h.useState({type:[],status:["active"]}),f=B("gray.100","gray.700"),{isOpen:m,onOpen:a,onClose:g}=re(),j=A({base:!0,lg:!1}),O=A({base:!1,lg:!0});h.useEffect(()=>{(async()=>{try{const d=await F.getDogs({status:"active"});i(d),n(d)}catch(d){console.error("Error fetching recent dogs:",d)}})()},[]),h.useEffect(()=>{let t=s;if(r){const d=r.toLowerCase();t=t.filter(y=>y.breed.toLowerCase().includes(d)||y.color.toLowerCase().includes(d)||y.locationName.toLowerCase().includes(d)||y.name&&y.name.toLowerCase().includes(d))}l.type.length>0&&(t=t.filter(d=>l.type.includes(d.type))),l.status.length>0&&(t=t.filter(d=>l.status.includes(d.status))),n(t)},[r,l,s]);const S=t=>{b(t),j&&g()},M=()=>e.jsxs(k,{h:"100%",spacing:4,align:"stretch",children:[e.jsxs(X,{children:[e.jsx(J,{pointerEvents:"none",children:e.jsx(R,{color:"gray.300"})}),e.jsx(pe,{placeholder:"ค้นหาสุนัข...",value:r,onChange:t=>u(t.target.value)})]}),e.jsxs(ae,{closeOnSelect:!1,children:[e.jsx(ie,{as:I,leftIcon:e.jsx(N,{}),variant:"outline",children:"ตัวกรอง"}),e.jsxs(ce,{minWidth:"240px",children:[e.jsxs(L,{title:"ประเภท",type:"checkbox",value:l.type,onChange:t=>o({...l,type:t}),children:[e.jsx(w,{value:"lost",children:"สุนัขหาย"}),e.jsx(w,{value:"found",children:"พบสุนัข"})]}),e.jsxs(L,{title:"สถานะ",type:"checkbox",value:l.status,onChange:t=>o({...l,status:t}),children:[e.jsx(w,{value:"active",children:"กำลังค้นหา"}),e.jsx(w,{value:"resolved",children:"พบเจอแล้ว"})]})]})]}),e.jsx(x,{flex:"1",overflowY:"auto",children:e.jsx(K,{dogs:p,selectedDog:c,onDogSelect:S,columns:{base:1,md:1,lg:1}})})]});return e.jsxs(x,{h:"100vh",display:"flex",flexDirection:"column",children:[e.jsx(x,{bg:"white",py:4,borderBottom:"1px",borderColor:f,children:e.jsx(k,{spacing:3,px:4,children:e.jsx(le,{size:"lg",textAlign:"center",color:"brand.500",children:"แผนที่สุนัขหาย/พบในเชียงใหม่"})})}),e.jsxs(x,{flex:"1",display:"flex",position:"relative",children:[O&&e.jsx(x,{w:"400px",h:"100%",borderRight:"1px",borderColor:f,bg:"white",p:4,overflowY:"auto",children:e.jsx(M,{})}),e.jsxs(x,{flex:"1",position:"relative",children:[e.jsxs(P,{center:ge,zoom:13,style:{height:"100%",width:"100%"},children:[e.jsx(ye,{selectedDog:c}),e.jsx(U,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors © <a href="https://carto.com/attributions">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),p.map(t=>e.jsx(W,{position:[t.location.coordinates[1],t.location.coordinates[0]],icon:(c==null?void 0:c._id)===t._id?t.type==="lost"?be:je:t.type==="lost"?me:xe,eventHandlers:{click:()=>S(t)},children:e.jsx(Q,{children:e.jsx(x,{className:"custom-popup",p:2,maxW:"200px",children:e.jsxs(k,{align:"stretch",spacing:2,children:[e.jsx(ue,{colorScheme:t.type==="lost"?"red":"green",fontSize:"xs",px:2,py:.5,borderRadius:"full",alignSelf:"flex-start",children:t.type==="lost"?"สุนัขหาย":"พบสุนัข"}),e.jsx(C,{fontWeight:"bold",fontSize:"sm",noOfLines:1,children:t.name||t.breed}),e.jsx(C,{fontSize:"xs",color:"gray.600",noOfLines:1,children:t.locationName}),e.jsx(I,{as:_,to:`/dogs/${t._id}`,size:"xs",colorScheme:"brand",width:"full",mt:1,children:"ดูรายละเอียด"})]})})})},t._id))]}),j&&e.jsx(q,{"aria-label":"Toggle Sidebar",icon:m?e.jsx(T,{}):e.jsx(V,{}),position:"absolute",top:4,right:4,onClick:m?g:a,colorScheme:"brand",size:"lg",zIndex:1e3,bg:"white",color:"gray.800",_hover:{bg:"gray.100"},boxShadow:"md"})]}),e.jsxs(ee,{isOpen:m,placement:"left",onClose:g,size:"full",children:[e.jsx(se,{}),e.jsxs(te,{children:[e.jsx(oe,{}),e.jsx(Y,{borderBottomWidth:"1px",children:"รายการสุนัขในพื้นที่"}),e.jsx(ne,{p:4,children:e.jsx(M,{})})]})]})]}),c&&e.jsx(G,{selectedDog:c,allDogs:s,onMatchSelect:S})]})};export{Te as default};
